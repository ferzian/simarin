<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alur Selesai Magang - SKM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }

    .card {
      transition: all 0.3s ease;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      min-height: 380px;
      max-height: 380px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card-content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .locked {
      filter: grayscale(0.7);
      cursor: not-allowed;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    .clickable:hover {
      transform: scale(1.05);
      transition: transform 0.2s ease;
    }
  </style>
</head>

<body class="bg-gray-50">
  <div class="max-w-6xl mx-auto py-8 px-4">

    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">üöÄ Alur Selesai Kegiatan Magang</h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">Ikuti langkah-langkah di bawah ini untuk menyelesaikan proses
        magang dan mendapatkan sertifikat Anda.</p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-12 bg-white rounded-xl shadow-md p-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Progress Penyelesaian Magang</h2>
      <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
        <div id="progress-bar" class="h-4 rounded-full bg-green-500 transition-all duration-500" style="width:33%;">
        </div>
      </div>
      <div class="flex justify-between text-sm text-gray-600">
        <span>0%</span>
        <span id="progress-percentage">33%</span>
        <span>100%</span>
      </div>
    </div>

    <!-- Cards Container -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
      <!-- Card 1: Kegiatan Harian Magang -->
      <div class="card bg-gradient-to-br from-indigo-400 to-indigo-500 p-6 rounded-2xl text-white text-center clickable hover:scale-105 transition"
           onclick="openStep('Kegiatan Harian Magang', '/user/kegiatan/form')">
        <div class="card-content">
          <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">üìÖ</div>
          </div>
          <h2 class="text-2xl font-bold mb-2">Kegiatan Harian Magang</h2>
          <p class="opacity-90 mb-4">Klik untuk mengisi kegiatan harian Anda sesuai hari kerja magang.</p>
          <div class="mt-auto">
            <button class="bg-white text-indigo-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 transition"
              onclick="openStep('Kegiatan Harian Magang', '/user/kegiatan/form')">
              Mulai Mengisi
            </button>
          </div>
        </div>
      </div>

      <!-- Card 2: Isi Survey Kepuasan -->
      <div class="card bg-gradient-to-br from-green-400 to-green-500 p-6 rounded-2xl text-white text-center relative clickable"
           onclick="openStep('Survey Kepuasan', 'https://ptsp.kkp.go.id/skm/s/3327')">
        <div class="card-content">
          <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">‚úÖ</div>
          </div>
          <h2 class="text-2xl font-bold mb-2">1. Isi Survey Kepuasan</h2>
          <p class="text-xl mb-4">Isi survey dan screenshot lalu upload di card berikutnya</p>
          <div class="mt-auto">
            <button class="bg-white text-green-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 transition"
              onclick="openStep('Survey Kepuasan', 'https://ptsp.kkp.go.id/skm/s/3327')">
              Isi Survey
            </button>
          </div>
        </div>
      </div>

      <!-- Card 3: Upload Screenshot Si Susan -->
      <div class="card bg-gradient-to-br from-blue-400 to-blue-500 p-6 rounded-2xl text-white text-center relative clickable"
           onclick="openStep('Upload Screenshot Si Susan', '/user/upload-susan')">
        <div class="card-content">
          <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">üñºÔ∏è</div>
          </div>
          <h2 class="text-2xl font-bold mb-2">2. Upload Screenshot Si Susan</h2>
          <div class="mt-auto">
            <button class="bg-white text-blue-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 transition mb-4"
              onclick="openStep('Upload Screenshot Si Susan', '/user/upload-susan')">
              Upload Screenshot
            </button>
            <div class="p-2 bg-white bg-opacity-20 rounded-lg">
              <p class="text-sm">
                Status: <span class="font-semibold">
                  <% if(statusUploadSusan === 'approved') { %>
                    Sudah Upload & Disetujui
                  <% } else if(statusUploadSusan === 'menunggu_approval') { %>
                    Menunggu Persetujuan
                  <% } else { %>
                    Belum Upload
                  <% } %>
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Card 4: Upload Laporan -->
      <div class="card bg-gradient-to-br from-yellow-400 to-yellow-500 p-6 rounded-2xl text-white text-center relative clickable">
        <div class="card-content">
          <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">üìë</div>
          </div>
          <h2 class="text-2xl font-bold mb-2">3. Upload Laporan</h2>
          <p class="opacity-90 mb-4">Kumpulkan laporan magang Anda.</p>
          <div class="mt-auto">
            <button
            class="bg-yellow-600 text-white font-semibold py-2 px-6 rounded-full hover:bg-yellow-700 transition mb-4"
            <% if(statusUploadSusan !== 'approved') { %> disabled class="bg-gray-300 text-gray-500 cursor-not-allowed" <% } else { %> onclick="window.location.href='/user/upload-laporan'" <% } %>
          >
            <% if(statusUploadSusan === 'approved'){ %>
              Upload Laporan
            <% } else if(statusUploadSusan === 'menunggu_approval'){ %>
              üîí Menunggu persetujuan Upload Susan
            <% } else { %>
              üîí Belum Upload Screenshot Si Susan
            <% } %>
          </button>
          
            <div class="p-2 bg-white bg-opacity-20 rounded-lg">
              <p class="text-sm">
                Status: <span class="font-semibold">Menunggu upload</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Card 5: Unduh Sertifikat -->
      <div class="card bg-gradient-to-br from-gray-300 to-gray-400 p-6 rounded-2xl text-white text-center relative">
        
        <div class="card-content">
          <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">üîí</div>
          </div>
          <h2 class="text-2xl font-bold mb-2">4. Unduh Sertifikat</h2>
          <p class="opacity-90 mb-4">Anda belum mengunggah atau laporan belum disetujui.</p>
          <div class="mt-auto">
            <button class="bg-gray-200 text-gray-600 font-semibold py-2 px-6 rounded-full cursor-not-allowed"
              disabled>
              Terkunci
            </button>
          </div>
        </div>
      </div>

      <!-- Card 6: Evaluasi Pelayanan Magang -->
      <div class="card bg-gradient-to-br from-pink-400 to-pink-500 p-6 rounded-2xl text-white text-center relative hover:scale-105 transition cursor-pointer"
     onclick="openStep('Evaluasi Pelayanan Magang', '/user/evaluasi')">
  <div class="card-content flex flex-col">
    <div class="flex justify-center mb-4">
      <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">üìù</div>
    </div>
    <h2 class="text-2xl font-bold mb-2">5. Evaluasi Pelayanan Magang</h2>
    <p class="opacity-90 mb-4">Isi evaluasi pengalaman magang Anda untuk peningkatan kualitas program.</p>
    <div class="mt-auto">
      <div class="bg-white text-pink-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 transition inline-block">
        Isi Survey
      </div>
    </div>
  </div>
</div>


  <script>
    function openStep(stepName, url) {
      alert(`Membuka: ${stepName}\nURL: ${url}`);
      // window.location.href = url; // Uncomment untuk mengaktifkan navigasi
    }
    
    // Mencegah event bubbling dari tombol ke card
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.card button').forEach(button => {
        button.addEventListener('click', function(e) {
          e.stopPropagation();
        });
      });
    });
  </script>
</body>
</html>
  <script>
    let statusLaporan = "<%= typeof statusLaporan !== 'undefined' ? statusLaporan : 'belum_upload' %>";

    const certificateCard = document.getElementById('certificate-card');
    const certificateText = document.getElementById('certificate-text');
    const progressBar = document.getElementById('progress-bar');
    const progressPercentage = document.getElementById('progress-percentage');
    const uploadStatus = document.getElementById('upload-status');

    function openStep(step, url) {
      Swal.fire({
        title: step,
        text: `Apakah Anda ingin melanjutkan ke bagian ${step}?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#2563eb',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, lanjut!',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = url;

        }
      });
    }

          function updateUI(status) {
        let progressWidth = '25%', progressText = '25%';

        if (status === 'laporan_harian_done') { 
          progressWidth = '50%'; 
          progressText = '50%'; 
        }
        if (status === 'menunggu_approval') { 
          progressWidth = '75%'; 
          progressText = '75%'; 
        }
        if (status === 'approved') { 
          progressWidth = '100%'; 
          progressText = '100%'; 
        }
        
        progressBar.style.width = progressWidth;
        progressPercentage.textContent = progressText;
      uploadStatus.innerHTML = status === 'belum_upload' ?
        '<p class="text-sm">Status: <span class="font-semibold">Menunggu upload</span></p>' :
        '<p class="text-sm">Status: <span class="font-semibold">Laporan terkirim</span></p>';

      if (status === 'approved') {
        certificateCard.classList.remove('from-gray-300', 'to-gray-400', 'locked');
        certificateCard.classList.add('from-purple-400', 'to-purple-600', 'pulse');
        certificateText.textContent = 'Sertifikat dapat diunduh setelah laporan disetujui admin.';
        const btn = certificateCard.querySelector('button');
        btn.className = 'bg-white text-purple-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 cursor-pointer';
        btn.textContent = 'Unduh Sertifikat';
        btn.disabled = false;
        btn.setAttribute("onclick", "openStep('Unduh Sertifikat','/sertifikat/<%= user ? user.id : '' %>')");

        certificateCard.querySelector('.text-2xl').textContent = 'üéì';
      } else if (status === 'menunggu_approval') {
        certificateText.textContent = 'Menunggu persetujuan laporan dari admin.';
        certificateCard.querySelector('.text-2xl').textContent = '‚è≥';
      } else {
        certificateText.textContent = 'Anda belum mengunggah laporan magang.';
        certificateCard.querySelector('.text-2xl').textContent = 'üîí';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('Status laporan dari server:', statusLaporan); // debug
      updateUI(statusLaporan);

      // Upload button hanya buka halaman
      const uploadBtn = document.getElementById('uploadBtn');
      uploadBtn.addEventListener('click', () => openStep('Upload Laporan', '/user/laporan'));
    });
  </script>

</body>

</html>
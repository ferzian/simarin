<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alur Selesai Magang - SKM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }

    .card {
      transition: all 0.3s ease;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6 -2 rgba(0, 0, 0, 0.05);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5 rgba(0, 0, 0, 0.1), 0 10px 10px -5 rgba(0, 0, 0, 0.04);
    }

    .locked {
      filter: grayscale(0.7);
      cursor: not-allowed;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }
  </style>
</head>

<body class="bg-gray-50">
  <div class="max-w-6xl mx-auto py-8 px-4">

    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">🚀 Alur Selesai Kegiatan Magang</h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">Ikuti langkah-langkah di bawah ini untuk menyelesaikan proses
        magang dan mendapatkan sertifikat Anda.</p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-12 bg-white rounded-xl shadow-md p-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Progress Penyelesaian Magang</h2>
      <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
        <div id="progress-bar" class="h-4 rounded-full bg-green-500 transition-all duration-500" style="width:33%;">
        </div>
      </div>
      <div class="flex justify-between text-sm text-gray-600">
        <span>0%</span>
        <span id="progress-percentage">33%</span>
        <span>100%</span>
      </div>
    </div>

    <!-- Cards -->
    <div class="grid md:grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
      
  
      <!-- Step 1 -->
      <div class="card bg-gradient-to-br from-green-400 to-green-500 p-6 rounded-2xl text-white text-center relative">
        <div class="flex justify-center mb-4">
          <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">✅</div>
        </div>
        <h2 class="text-2xl font-bold mb-2">1. Isi Survey Kepuasan</h2>
         <p class="text-sm">
    Status: <span class="font-semibold"><%= user.id %></span>
  </p>
        <p class="opacity-90 mb-4"></p>
        <button onclick="openStep('Survey Kepuasan','https://ptsp.kkp.go.id/skm/s/3327')"
          class="bg-white text-green-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 transition">Isi
          Survey</button>
      </div>

      
      <!-- Step 2 -->
      <div class="card bg-gradient-to-br from-yellow-400 to-yellow-500 p-6 rounded-2xl text-white text-center relative">
        <div class="flex justify-center mb-4">
          <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">📑</div>
        </div>
        <h2 class="text-2xl font-bold mb-2">2. Upload Laporan</h2>
        <p class="opacity-90 mb-4">Kumpulkan laporan </p>
        <button id="uploadBtn"
          class="bg-white text-yellow-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 transition">Upload
          Laporan</button>
        <div id="upload-status" class="mt-4 p-2 bg-white bg-opacity-20 rounded-lg">
          <p class="text-sm">Status: <span class="font-semibold">Menunggu upload</span></p>
        </div>
      </div>
      <% if (statusLaporan=='approved' ) { %>
        <!-- Step 3 -->
        <div id="certificate-card"
          class="card bg-gradient-to-br from-gray-300 to-gray-400 p-6 rounded-2xl text-white text-center relative">
          <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl"></div>
          </div>
          <h2 class="text-2xl font-bold mb-2">3. Unduh Sertifikat</h2>
          <p id="certificate-text" class="opacity-90 mb-4"></p>
          <button id="certificate-btn"
            class="bg-gray-200 text-gray-600 font-semibold py-2 px-6 rounded-full">Download</button>
        </div>
        <% } else { %>
          <div id="certificate-card"
            class="card bg-gradient-to-br from-gray-300 to-gray-400 p-6 rounded-2xl text-white text-center relative locked">
            <div class="flex justify-center mb-4">
              <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-2xl">🔒
              </div>
            </div>
            <h2 class="text-2xl font-bold mb-2">3. Unduh Sertifikat</h2>
            <p id="certificate-text" class="opacity-90 mb-4">Anda belum mengunggah laporan magang.</p>
            <button id="certificate-btn"
              class="bg-gray-200 text-gray-600 font-semibold py-2 px-6 rounded-full cursor-not-allowed"
              disabled>Terkunci</button>
          </div>
          <% } %>
    </div>

  </div>

  <script>
    let statusLaporan = "<%= typeof statusLaporan !== 'undefined' ? statusLaporan : 'belum_upload' %>";

    const certificateCard = document.getElementById('certificate-card');
    const certificateText = document.getElementById('certificate-text');
    const progressBar = document.getElementById('progress-bar');
    const progressPercentage = document.getElementById('progress-percentage');
    const uploadStatus = document.getElementById('upload-status');

    function openStep(step, url) {
      Swal.fire({
        title: step,
        text: `Apakah Anda ingin melanjutkan ke bagian ${step}?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#2563eb',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, lanjut!',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = url;

        }
      });
    }

          function updateUI(status) {
        let progressWidth = '25%', progressText = '25%';

        if (status === 'laporan_harian_done') { 
          progressWidth = '50%'; 
          progressText = '50%'; 
        }
        if (status === 'menunggu_approval') { 
          progressWidth = '75%'; 
          progressText = '75%'; 
        }
        if (status === 'approved') { 
          progressWidth = '100%'; 
          progressText = '100%'; 
        }

        progressBar.style.width = progressWidth;
        progressPercentage.textContent = progressText;
      uploadStatus.innerHTML = status === 'belum_upload' ?
        '<p class="text-sm">Status: <span class="font-semibold">Menunggu upload</span></p>' :
        '<p class="text-sm">Status: <span class="font-semibold">Laporan terkirim</span></p>';

      if (status === 'approved') {
        certificateCard.classList.remove('from-gray-300', 'to-gray-400', 'locked');
        certificateCard.classList.add('from-purple-400', 'to-purple-600', 'pulse');
        certificateText.textContent = 'Sertifikat dapat diunduh setelah laporan disetujui admin.';
        const btn = certificateCard.querySelector('button');
        btn.className = 'bg-white text-purple-600 font-semibold py-2 px-6 rounded-full hover:bg-opacity-90 cursor-pointer';
        btn.textContent = 'Unduh Sertifikat';
        btn.disabled = false;
        btn.setAttribute("onclick", "openStep('Unduh Sertifikat','/sertifikat/<%= user ? user.id : '' %>')");

        certificateCard.querySelector('.text-2xl').textContent = '🎓';
      } else if (status === 'menunggu_approval') {
        certificateText.textContent = 'Menunggu persetujuan laporan dari admin.';
        certificateCard.querySelector('.text-2xl').textContent = '⏳';
      } else {
        certificateText.textContent = 'Anda belum mengunggah laporan magang.';
        certificateCard.querySelector('.text-2xl').textContent = '🔒';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('Status laporan dari server:', statusLaporan); // debug
      updateUI(statusLaporan);

      // Upload button hanya buka halaman
      const uploadBtn = document.getElementById('uploadBtn');
      uploadBtn.addEventListener('click', () => openStep('Upload Laporan', '/user/laporan'));
    });
  </script>

</body>

</html>